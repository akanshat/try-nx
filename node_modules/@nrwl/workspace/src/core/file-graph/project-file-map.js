"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createProjectFileMap = void 0;
function createProjectFileMap(workspaceJson, files) {
    const fileMap = {};
    const seen = new Set();
    // Sorting here so `apps/client-e2e` comes before `apps/client` and has
    // a chance to match prefix first.
    Object.keys(workspaceJson.projects)
        .sort((a, b) => {
        const projectA = workspaceJson.projects[a];
        const projectB = workspaceJson.projects[b];
        if (!projectA.root)
            return -1;
        if (!projectB.root)
            return -1;
        return projectA.root.length > projectB.root.length ? -1 : 1;
    })
        .forEach((projectName) => {
        const p = workspaceJson.projects[projectName];
        fileMap[projectName] = [];
        files.forEach((f) => {
            if (seen.has(f.file)) {
                return;
            }
            if (f.file.startsWith(p.root || p.sourceRoot)) {
                fileMap[projectName].push(f);
                seen.add(f.file);
            }
        });
    });
    return fileMap;
}
exports.createProjectFileMap = createProjectFileMap;
//# sourceMappingURL=project-file-map.js.map
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.updateProjectRootFiles = void 0;
const app_root_1 = require("@nrwl/tao/src/utils/app-root");
const path = require("path");
const path_1 = require("path");
/**
 * Updates the files in the root of the project
 *
 * Typically these are config files which point outside of the project folder
 *
 * @param schema The options provided to the schematic
 */
function updateProjectRootFiles(tree, schema, project) {
    const newRelativeRoot = path
        .relative(path.join(app_root_1.appRootPath, schema.relativeToRootDestination), app_root_1.appRootPath)
        .split(path.sep)
        .join('/');
    const oldRelativeRoot = path
        .relative(path.join(app_root_1.appRootPath, project.root), app_root_1.appRootPath)
        .split(path.sep)
        .join('/');
    if (newRelativeRoot === oldRelativeRoot) {
        // nothing to do
        return;
    }
    const dots = /\./g;
    const regex = new RegExp(oldRelativeRoot.replace(dots, '\\.'), 'g');
    for (const file of tree.children(schema.relativeToRootDestination)) {
        if (!path_1.extname(file).startsWith('.js')) {
            continue;
        }
        if (file === '.eslintrc.json') {
            continue;
        }
        const oldContent = tree.read(path_1.join(schema.relativeToRootDestination, file), 'utf-8');
        const newContent = oldContent.replace(regex, newRelativeRoot);
        tree.write(path_1.join(schema.relativeToRootDestination, file), newContent);
    }
}
exports.updateProjectRootFiles = updateProjectRootFiles;
//# sourceMappingURL=update-project-root-files.js.map
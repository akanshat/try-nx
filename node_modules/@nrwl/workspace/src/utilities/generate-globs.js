"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createGlobPatternsForDependencies = void 0;
const devkit_1 = require("@nrwl/devkit");
const app_root_1 = require("@nrwl/tao/src/utils/app-root");
const path_1 = require("path");
const project_graph_1 = require("../core/project-graph");
const project_graph_utils_1 = require("./project-graph-utils");
/**
 * Generates a set of glob patterns based off the source root of the app and its dependencies
 * @param dirPath workspace relative directory path that will be used to infer the parent project and dependencies
 * @param fileGlobPattern pass a custom glob pattern to be used
 */
function createGlobPatternsForDependencies(dirPath, fileGlobPattern) {
    const filenameRelativeToWorkspaceRoot = path_1.relative(app_root_1.appRootPath, dirPath);
    const projectGraph = project_graph_1.readCachedProjectGraph('4.0');
    // find the project
    let projectName;
    try {
        projectName = project_graph_utils_1.getProjectNameFromDirPath(filenameRelativeToWorkspaceRoot, projectGraph);
    }
    catch (e) {
        throw new Error(`createGlobPatternsForDependencies: Error when trying to determine main project.\n${e === null || e === void 0 ? void 0 : e.message}`);
    }
    // generate the glob
    try {
        const projectDirs = project_graph_utils_1.getSourceDirOfDependentProjects(projectName, projectGraph);
        return projectDirs.map((sourceDir) => path_1.resolve(app_root_1.appRootPath, devkit_1.joinPathFragments(sourceDir, fileGlobPattern)));
    }
    catch (e) {
        throw new Error(`createGlobPatternsForDependencies: Error when generating globs.\n${e === null || e === void 0 ? void 0 : e.message}`);
    }
}
exports.createGlobPatternsForDependencies = createGlobPatternsForDependencies;
//# sourceMappingURL=generate-globs.js.map